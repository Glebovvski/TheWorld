"use strict";var app=angular.module("app-trips",["simpleControls","ngRoute"]);function _showMap(t){if(t&&0<t.length){var o=_.map(t,function(t){return{lat:t.latitude,long:t.longitude,info:t.name}});travelMap.createMap({stops:o,selector:"#map",currentStop:1,initialZoom:3})}}app.config(["$routeProvider","$locationProvider",function(t,o){o.hashPrefix(""),t.when("/",{controller:"tripsController",templateUrl:"/views/tripsView.html"}),t.when("/editor/:tripName",{controller:"tripEditorController",templateUrl:"/views/tripEditorView.html"}),t.otherwise({redirectTo:"/"})}]),app.controller("tripsController",["$scope","$http",function(o,t){o.trips=[],o.newTrip={},o.errorMessage="",o.isBusy=!0,t.get("/api/trips").then(function(t){angular.copy(t.data,o.trips)},function(t){o.errorMessage="Failed to load data: "+t}).finally(function(){o.isBusy=!1}),o.addTrip=function(){o.isBusy=!0,o.errorMessage="",t.post("/api/trips",o.newTrip).then(function(t){o.trips.push(t.data),o.newTrip={}},function(t){o.errorMessage="Failed to save new trip"}).finally(function(){o.isBusy=!1})}}]),app.controller("tripEditorController",["$scope","$http","$routeParams",function(o,t,r){o.tripName=r.tripName,o.stops=[],o.errorMessage="",o.isBusy=!0,o.newStop={},t.get("/api/trips/"+o.tripName+"/stops").then(function(t){angular.copy(t.data,o.stops),_showMap(o.stops)},function(t){o.errorMessage="Failed to load stops"}).finally(function(){o.isBusy=!1}),o.addStop=function(){o.isBusy=!0,t.post("/api/trips/"+o.tripName+"/stops",o.newStop).then(function(t){o.stops.push(t.data),_showMap(o.stops),o.newStop={}},function(t){o.errorMessage="Failed to add new stop"+t}).finally(function(){o.isBusy=!1})}}]);